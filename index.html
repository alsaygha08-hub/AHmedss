<!DOCTYPE html>
<html>
<head>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type" />
<title>English 3 Speaking Milestone 3</title>
<!-- لا نحتاج prompts.js في الوضع المحلي -->
<script type="text/javascript" src="jquery-3.6.4.min.js"></script>
<script type="text/javascript" src="jquery-ui.min.js"></script>
<script type="text/javascript" src="jquery.ui.touch-punch.min.js"></script>

<style>
.promptHolder {
  background-color: #f7f7f7;
  border: 2px solid #EBEBEB;
  color: #468283;
  font-size: calc(1.75vw + 1.75vh);
  vertical-align: middle;
  width: 90%;
  border-radius: 10px;
  margin: auto;
  font-family:'Trebuchet MS','Lucida Sans Unicode','Lucida Grande','Lucida Sans',Arial,sans-serif;
  justify-content: center;
  align-items: center;
  padding: 1em;
}
#pageHead { color:#468283; font-family:'Trebuchet MS','Lucida Sans Unicode','Lucida Grande','Lucida Sans',Arial,sans-serif }
#closeX { cursor:pointer; }
#cont { text-align:center; height:95vh; width:95vw; overflow:scroll; margin:auto; }
#overlay { position:fixed; top:0; left:0; width:100%; height:100%; background-color:rgba(255,255,255,0.7); display:flex; justify-content:center; align-items:center; z-index:1000; }
.butt {
  background-color:#84BD00; color:#fff; border-radius:6px; width:100px; left:50%;
  transform:translateX(-50%) translateZ(0); padding:10px; text-align:center;
  font-family:'Trebuchet MS','Lucida Sans Unicode','Lucida Grande','Lucida Sans',Arial,sans-serif;
  font-size:1.5em; box-shadow:0 2px 5px rgba(0,0,0,0.3); position:fixed; bottom:20px; cursor:pointer;
}
.pCount{ width:93vw; text-align:center; font-family:'Trebuchet MS','Lucida Sans Unicode','Lucida Grande','Lucida Sans',Arial,sans-serif; }
.zoom { position:absolute; top:5px; left:5px; width:100vw; height:100vh; background-color:rgba(255,255,255,0.9); z-index:999; }
.butt:active { transform:translateX(-50%) translateZ(0) scale(0.96); box-shadow:0 2px 4px rgba(0,0,0,0.3); }
#imageHolder { width:90%; justify-content:center; cursor:pointer; display:none; margin:auto; overflow:visible; }
#promptPic { display:block; margin:10px auto; max-width:250px; max-height:150px; box-shadow:0 2px 2px rgba(0,0,0,0.3); cursor:pointer; }
@media only screen and (max-width:750px){ .promptHolder{font-size:2em;width:85%} .pCount{width:85%;padding-left:5rem} }
@media only screen and (max-width:500px){ .pCount{padding-left:3rem} #promptPic{max-width:150px} }
</style>

<script>
/* ========= متغيرات عامة ========= */
window.sounds = [];
window.promptBank = [];
window.counter = 0;

/* ========= صفحات البداية ========= */
window.shuffle = function (array) {
  var currentIndex = array.length, temporaryValue, randomIndex;
  while (currentIndex !== 0) {
    randomIndex = Math.floor(Math.random() * currentIndex);
    currentIndex -= 1;
    temporaryValue = array[currentIndex];
    array[currentIndex] = array[randomIndex];
    array[randomIndex] = temporaryValue;
  }
  return array;
};

window.introPage = function(){
  $("#butt").hide();
  $("#promptHolder").html(
    `<h2 class="iHead" style="font-size:2rem">English 3 Speaking Milestone 3</h2>
     <div class="iText" style="font-size:1.5rem;font-weight:500;margin-top:8vh">
       <p style="line-height:2rem;display:block;">Please say your name and badge number.</p>
       <p>Tap OK to proceed.</p>
     </div>`
  );
  $("#butt1").fadeIn(500);
  badge.play();
};

window.landingPage = function(){
  badge.pause();
  $("#butt1").hide();
  $("#promptHolder").html(
    `<h2 class="iHead" style="font-size:2rem">English 3 Speaking Milestone 3</h2>
     <div class="iText" style="font-size:1.5rem;font-weight:500;margin-top:8vh;line-height:1.5rem">
       <p>You will see and hear 12 prompts.</p>
       <p>After you hear each prompt, respond, then tap “Next”.</p>
       <p>If you see a picture, you can tap it to enlarge.</p>
       <p>When you are ready, tap “Start”.</p>
     </div>`
  );
  $("#butt2").fadeIn(500);
  instr.play();
};

window.startActivity = function(){
  instr.pause();
  $("#butt2").hide();
  $("#pageHead").show();
  $("#butt2").text("Next");
  document.getElementById('image_holder').style.display = "none";
  counter++;

  if(counter > promptBank.length){
    $("#promptHolder").text("You have finished.");
    $("#pCount").hide();
    $("#butt2").hide();
    $("#butt3").fadeIn();
    endBlurb.play();
  }else{
    $("#pCount").show();
    $("#promptHolder").text(promptBank[counter-1].text);
    audioElements[counter-1].play();
    $("#pno").text(counter+" / ");
    if (promptBank[counter-1].image && promptBank[counter-1].image.length > 0){
      document.getElementById('image_holder').style.display = "block";
      document.getElementById('promptPic').src = promptBank[counter-1].image;
    }
  }
};

window.enlarge = function(){
  $("#image_holder").addClass('zoom');
  var tgtImg = document.getElementById('promptPic');
  tgtImg.style.maxWidth = "80vw";
  tgtImg.style.maxHeight = "75vh";
  document.getElementById('cap').style.backgroundColor = "white";
  document.getElementById('cap').style.fontSize = "1.25rem";
  document.getElementById('cap').innerText = document.getElementById('promptHolder').innerText;
  document.getElementById('closeX').style.display = "block";
};

window.closeImg = function(){
  $("#cap").text("Tap to enlarge");
  document.getElementById('cap').style.fontSize = "1rem";
  $('#image_holder').removeClass('zoom');
  document.getElementById('promptPic').style.maxWidth = "250px";
  document.getElementById('closeX').style.display = "none";
};

window.startOver = function(){ location.reload(); };

/* ========= الوضع المحلي بالكامل (بدون Blackboard) ========= */
function initLocal() {
  // 12 سؤال — عدّل النصوص لو تبغى. أسماء الصوتيات g1..g10 يجب أن تكون موجودة في نفس المجلد.
  window.promptBank = [
    { text: "Talk about a rule you follow at work.",        audio: "g1"  },
    { text: "Make or refuse an offer politely.",            audio: "g2"  },
    { text: "Say how willing you are to help in a task.",   audio: "g3"  },
    { text: "Invite a colleague and handle a question.",    audio: "g7"  },
    { text: "Ask for clarification about a task.",          audio: "g8"  },
    { text: "State a requirement for a process.",           audio: "g9"  },
    { text: "Describe a mistake and how to fix it.",        audio: "g10" },
    { text: "Explain an abbreviation you use.",             audio: "g1"  },
    { text: "Assign a task to a teammate.",                 audio: "g2"  },
    { text: "Talk about responsibilities in your role.",    audio: "g3"  },
    { text: "Explain the purpose of a tool you use.",       audio: "g7"  },
    { text: "Talk about range/duration for a project.",     audio: "g8"  }
  ];

  // جهّز الصوتيات
  window.sounds = promptBank.map(p => "./" + p.audio + ".mp3");
  window.audioElements = sounds.map(file => {
    const a = new Audio(file);
    a.onended = function(){ $('#butt2').fadeIn(); }; // يظهر زر Next عند انتهاء الصوت
    return a;
  });

  // عدّاد الأسئلة وإخفاء شاشة التحميل
  $("#pto").text(promptBank.length);
  $("#pCount").hide();
  const ov = document.getElementById('overlay');
  if (ov) ov.style.display = "none";
}

// شغّل الوضع المحلي عند التحميل
window.addEventListener('load', initLocal);
</script>
</head>

<body>
  <div id="overlay">
    <img src="loading.gif" alt="Loading" id="loading-image">
  </div>

  <div id="cont">
    <h1 id="pageHead" style="display:none;">English 3 Speaking Milestone 3</h1>

    <div id="pCount" class="pCount">
      <div style="margin-left:auto; margin-right:0; margin-bottom:5px; width:75px; padding:5px; border-radius:7px;">
        <span id="pno" style="font-size:1.25em"></span><span id="pto"></span>
      </div>
    </div>

    <div class="promptHolder" id="promptHolder">
      <h2 class="iHead" style="font-size:2rem; margin:0 0 1.5rem 0">English 3 Speaking Milestone 3</h2>
      <div class="iText" style="font-size:1.5rem; font-weight:500; margin-top:0.5rem">
        <span style="font-weight:bold">This assessment covers these functions:</span>
      </div>
      <div class="iText" style="display:flex; justify-content:center; margin-left:auto; font-size:1.5rem;">
        <ul style="text-align:left;">
          <li>Talking about rules</li>
          <li>Making, accepting, and refusing offers</li>
          <li>Talking about willingness</li>
          <li>Inviting and handling questions</li>
          <li>Asking for, offering, and providing clarification</li>
          <li>Talking about requirements</li>
          <li>Talking about mistakes</li>
          <li>Talking about abbreviations</li>
          <li>Assigning tasks</li>
          <li>Talking about responsibilities</li>
          <li>Talking about purpose and function</li>
          <li>Talking about range and duration</li>
        </ul>
      </div>
    </div>

    <div id="image_holder" style="display:none">
      <span id="closeX" style="text-align:center; position:absolute; right:2%; font-family:arial; font-weight:bold; display:none; background-color:black; border-radius:20px; padding:5px; width:20px; color:white;" onclick="closeImg()">X</span>
      <img id="promptPic" src="" onclick="enlarge()">
      <p id="cap" style="text-align:center; font-family:'Trebuchet MS'">Tap to enlarge</p>
    </div>

    <div style="margin-top:2em">
      <div class="butt" id="butt"  onclick="introPage()">Continue</div>
      <div class="butt" id="butt1" style="display:none;" onclick="landingPage()">OK</div>
      <div class="butt" id="butt2" style="display:none;" onclick="startActivity()">Start</div>
      <div class="butt" id="butt3" style="display:none"  onclick="startOver();">Restart</div>
    </div>
  </div>

  <script>
    // أصوات البداية/النهاية
    window.endBlurb = document.createElement("AUDIO"); endBlurb.src = "E3_E4_End.mp3";
    window.badge    = document.createElement("AUDIO"); badge.src    = "E3_SM3_Intro.mp3";
    window.instr    = document.createElement("AUDIO"); instr.src    = "E3_4_SM3_Inst.mp3";
    window.tgtPhrase = document.createElement("AUDIO");
    tgtPhrase.onended = function(){ $('#butt2').fadeIn(); };
  </script>
</body>
</html>
